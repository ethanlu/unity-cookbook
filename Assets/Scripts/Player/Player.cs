using System;
using Player.Animations;
using Player.Data;
using Utils;
using UnityEngine;

namespace Player
{
    [RequireComponent(typeof(BoxCollider2D))]
    [RequireComponent(typeof(Rigidbody2D))]
    public class Player : MonoBehaviour
    {
        ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        // customizable fields
        
        [SerializeField] protected MoveConfiguration _moveConfiguration;
        [SerializeField] protected JumpConfiguration _jumpConfiguration;
        [SerializeField] protected AttackConfiguration _attackConfiguration;

        ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        // unity components

        ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        // internal properties
        
        protected PlayerStateMachine _stateMachine;

        ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        // internal methods

        ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        // event delegates

        ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        // core unity behavior
        
        protected void Awake()
        {
        }

        protected void Start()
        {
            _stateMachine = new PlayerStateMachine(
                GetComponent<Rigidbody2D>(),
                GetComponent<BoxCollider2D>(),
                GameObject.Find("PlayerVisual").GetComponent<PlayerAnimator>(),
                _moveConfiguration,
                _jumpConfiguration,
                _attackConfiguration
            );
            _stateMachine.Start(PlayerStateMachine.InitialState);
        }
        
        protected void Update()
        {
            _stateMachine.Update();
        }
        
        protected void FixedUpdate()
        {
            _stateMachine.FixedUpdate();
        }
    }
}