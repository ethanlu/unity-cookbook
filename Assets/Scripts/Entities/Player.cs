using System;
using Animations;
using Entities.Data;
using Utils;
using UnityEngine;

namespace Entities
{
    [RequireComponent(typeof(BoxCollider2D))]
    [RequireComponent(typeof(Rigidbody2D))]
    public class Player : MonoBehaviour
    {
        ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        // customizable fields

        [SerializeField] protected GameObject _visual;
        [SerializeField] protected MoveConfiguration _moveConfiguration;
        [SerializeField] protected JumpConfiguration _jumpConfiguration;
        [SerializeField] protected AttackConfiguration _attackConfiguration;

        ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        // unity components

        protected BoxCollider2D _boxCollider2D;
        protected Rigidbody2D _rigidbody2D;

        protected PlayerAnimator _playerAnimator;

        ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        // internal properties

        // states
        protected PlayerStateMachine _stateMachine;

        ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        // internal methods

        ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        // getters

        public PlayerAnimator PlayerAnimator() { return _playerAnimator; }
        public BoxCollider2D BoxCollider2D() { return _boxCollider2D; }
        public JumpConfiguration JumpConfiguration() { return _jumpConfiguration; }
        public MoveConfiguration MoveConfiguration() { return _moveConfiguration; }
        public AttackConfiguration AttackConfiguration() { return _attackConfiguration; }

        public Rigidbody2D Rigidbody2D() { return _rigidbody2D; }

        ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        // event delegates

        ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        // core unity behavior
        
        protected void Awake()
        {
        }

        protected void Start()
        {
            _rigidbody2D = GetComponent<Rigidbody2D>();
            _boxCollider2D = GetComponent<BoxCollider2D>();
            _playerAnimator = _visual.GetComponent<PlayerAnimator>();

            _stateMachine = new PlayerStateMachine(this, PlayerStateMachine.InitialState);
        }
        
        protected void Update()
        {
            _stateMachine.RunStateUpdate();
        }
        
        protected void FixedUpdate()
        {
            _stateMachine.RunStateFixedUpdate();
        }
    }
}